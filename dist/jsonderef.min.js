!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("jsonDeref",[],r):"object"==typeof exports?exports.jsonDeref=r():t.jsonDeref=r()}(this,function(){return function(t){function r(e){if(n[e])return n[e].exports;var o=n[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var n={};return r.m=t,r.c=n,r.p="",r(0)}([function(t,r,n){(function(t){"use strict";function e(t){return t&&t.__esModule?t:{"default":t}}function o(t){if(Array.isArray(t)){for(var r=0,n=Array(t.length);r<t.length;r++)n[r]=t[r];return n}return Array.from(t)}function i(t,r){var n={};for(var e in t)r.indexOf(e)>=0||Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n}function u(t,r){return r.some(function(r){return r.startsWith(t)})}function s(t){return t&&!t.startsWith("/")&&(t="/"+t),t}function c(r,n){function e(r,e){return new Promise(function(o,i){var u=Object.getOwnPropertyNames(d),s=u.indexOf(r),c=d[r];if(!c){var f=void 0;return r.startsWith("http://")||r.startsWith("https://")?f=g.web:r.startsWith("json:")?f=g.json:"node"===t.env.BABEL_ENV&&(f=g.file),(n.externalLoader?n.externalLoader(r,e,f):f(r)).then(function(t){c=d[r]={raw:t,parsed:{}},o(a({},c,{resourceId:u.length}))})}o(Object.assign({},c,{resourceId:s}))})}function c(t){function r(a,d,v,b,y){console.log("processNode "+v+(y?"("+y+")":"")+" with refChain "+b);var g=!!y,w=g?[y]:Object.getOwnPropertyNames(a),j=-1,m=0;return new Promise(function(O,x){function E(){j++,j===w.length?O(g?d[y]:m?d:a):!function(){var y=w[j],O=a[y],N=v+"/"+y;if(d.hasOwnProperty(y))m|=d[y]!==O,E();else if("object"!==("undefined"==typeof O?"undefined":l(O)))d[y]=O,E();else if(O.hasOwnProperty("$ref"))!function(){var r=O.$ref,a=i(O,["$ref"]),l=r.split("#"),v=f(l,2),w=v[0],j=v[1],A=void 0===j?"":j,P=[].concat(o(b),[N]);Promise.resolve().then(function(){return w?e(w,a):{raw:t,parsed:p,resourceId:h}}).then(function(t){var r=t.raw,e=t.parsed,o=t.resourceId;if(!w&&n.externalOnly)return O;var i=o+"#"+s(A);if(u(i,[N])||g&&u(i,b))throw new Error("pointer "+i+" is circular");return c(r,e,o,A,a,P)}).then(function(t){m=1,d[y]=t,E()})["catch"](function(t){n.failOnMissing?x(t):(d[y]=O,E())})}();else{var A=d[y]=Array.isArray(O)?[]:{};r(O,A,N,b).then(function(t){m|=t!==O,E()})["catch"](x)}}()}E()})}function a(n,e){var o=h+"#";return console.log("solveReference "+(o+e)+" with refChain "+n),e?Promise.resolve().then(function(){var i=t,u=p,c=s(e).split("/");c.shift();for(var f=c[0];u.hasOwnProperty(f);)i=i[f],u=u[f],o+="/"+c.shift(),f=c[0];return c.length?(f=c.shift(),Promise.resolve().then(function(){return r(i,u,o,n,f)}).then(function(t){if(!t)throw new Error(o+"/"+f+" of pointer "+e+" at "+n[n.length-1]+" did not return object");for(;t.hasOwnProperty(c[0])&&(t=t[c[0]]);)c.shift();if(c.length)throw new Error("invalid pointer "+e+" at "+n[n.length-1]);return t})):u}):r(t,p,o,n)}var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments[2],d=arguments[3],v=arguments[4],b=arguments[5];return n.localLoader?n.localLoader(d,v,a.bind(this,b)):a(b,d)}var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(n=Object.assign({},y,n),n.localLoader&&"function"!=typeof n.localLoader)throw new Error("options.localLoader must be a function");if(n.externalLoader&&"function"!=typeof n.externalLoader)throw new Error("options.externalLoader must be a function");var d={},g={web:function(t){return fetch(t).then(function(t){return t.text()}).then(function(t){return JSON.parse(t)})},json:function(t){if(t=t.substring(5),n.jsonResources.hasOwnProperty(t))return Promise.resolve(n.jsonResources[t]);throw new Error("can't find "+t)}};return h["default"]&&(g.file=function(t){return new Promise(function(r,e){h["default"].readFile(v["default"].resolve(n.basePath,t),"utf8",function(t,n){if(t)throw t;r(JSON.parse(n))})})}),Promise.resolve().then(function(){if("string"==typeof r)return e(r,{});if("object"===("undefined"==typeof r?"undefined":l(r)))return Object.assign(d,{json:{raw:r,parsed:Array.isArray(r)?[]:{}}}),d.json;throw new Error("Invalid param. Must be object, array or string")}).then(function(t){var r=t.raw,e=t.parsed,o={};return Object.getOwnPropertyNames(n.jsonResources).forEach(function(t){o["json:"+t]={raw:n.jsonResources[t],parsed:{}}}),Object.assign(d,o,n.cache?b:{}),c(r,e,0,p,{},[])})}var f=function(){function t(t,r){var n=[],e=!0,o=!1,i=void 0;try{for(var u,s=t[Symbol.iterator]();!(e=(u=s.next()).done)&&(n.push(u.value),!r||n.length!==r);e=!0);}catch(c){o=!0,i=c}finally{try{!e&&s["return"]&&s["return"]()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return t(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p=n(2),h=e(p),d=n(12),v=e(d),b={},y={cache:!0,cacheTTL:3e5,failOnMissing:!1,externalOnly:!1,requireStartSlash:!1,localLoader:void 0,externalLoader:void 0,jsonResources:{}};h["default"]&&(y.basePath=t.cwd()),r["default"]=c}).call(r,n(1))},function(t,r){function n(){f&&u&&(f=!1,u.length?c=u.concat(c):a=-1,c.length&&e())}function e(){if(!f){var t=setTimeout(n);f=!0;for(var r=c.length;r;){for(u=c,c=[];++a<r;)u&&u[a].run();a=-1,r=c.length}u=null,f=!1,clearTimeout(t)}}function o(t,r){this.fun=t,this.array=r}function i(){}var u,s=t.exports={},c=[],f=!1,a=-1;s.nextTick=function(t){var r=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];c.push(new o(t,r)),1!==c.length||f||setTimeout(e,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=i,s.addListener=i,s.once=i,s.off=i,s.removeListener=i,s.removeAllListeners=i,s.emit=i,s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,r,n){(function(t){"use strict";r.object=n(3),r.array=n(4),r.func=n(5),r.functionThatReturns=n(6),r.functionThatReturnsTrue=n(7),r.functionThatReturnsFalse=n(8),r.functionThatReturnsNull=n(9),r.functionThatReturnsThis=n(10),r.functionThatReturnsArgument=n(11),"production"!=t.env.NODE_ENV&&Object.freeze(r)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports={},"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=[],"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=function(){},"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=function(t){return function(){return t}},"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=n(6)(!0),"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=n(6)(!1),"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=n(6)(null),"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=function(){return this},"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(r){"use strict";t.exports=function(t){return t},"production"!=r.env.NODE_ENV&&Object.freeze(t.exports)}).call(r,n(1))},function(t,r,n){(function(t){function n(t,r){for(var n=0,e=t.length-1;e>=0;e--){var o=t[e];"."===o?t.splice(e,1):".."===o?(t.splice(e,1),n++):n&&(t.splice(e,1),n--)}if(r)for(;n--;n)t.unshift("..");return t}function e(t,r){if(t.filter)return t.filter(r);for(var n=[],e=0;e<t.length;e++)r(t[e],e,t)&&n.push(t[e]);return n}var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return o.exec(t).slice(1)};r.resolve=function(){for(var r="",o=!1,i=arguments.length-1;i>=-1&&!o;i--){var u=i>=0?arguments[i]:t.cwd();if("string"!=typeof u)throw new TypeError("Arguments to path.resolve must be strings");u&&(r=u+"/"+r,o="/"===u.charAt(0))}return r=n(e(r.split("/"),function(t){return!!t}),!o).join("/"),(o?"/":"")+r||"."},r.normalize=function(t){var o=r.isAbsolute(t),i="/"===u(t,-1);return t=n(e(t.split("/"),function(t){return!!t}),!o).join("/"),t||o||(t="."),t&&i&&(t+="/"),(o?"/":"")+t},r.isAbsolute=function(t){return"/"===t.charAt(0)},r.join=function(){var t=Array.prototype.slice.call(arguments,0);return r.normalize(e(t,function(t,r){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},r.relative=function(t,n){function e(t){for(var r=0;r<t.length&&""===t[r];r++);for(var n=t.length-1;n>=0&&""===t[n];n--);return r>n?[]:t.slice(r,n-r+1)}t=r.resolve(t).substr(1),n=r.resolve(n).substr(1);for(var o=e(t.split("/")),i=e(n.split("/")),u=Math.min(o.length,i.length),s=u,c=0;c<u;c++)if(o[c]!==i[c]){s=c;break}for(var f=[],c=s;c<o.length;c++)f.push("..");return f=f.concat(i.slice(s)),f.join("/")},r.sep="/",r.delimiter=":",r.dirname=function(t){var r=i(t),n=r[0],e=r[1];return n||e?(e&&(e=e.substr(0,e.length-1)),n+e):"."},r.basename=function(t,r){var n=i(t)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n},r.extname=function(t){return i(t)[3]};var u="b"==="ab".substr(-1)?function(t,r,n){return t.substr(r,n)}:function(t,r,n){return r<0&&(r=t.length+r),t.substr(r,n)}}).call(r,n(1))}])});